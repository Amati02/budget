<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Бюджет</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="category-icons.js"></script>

</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="user-info">
                <div class="user-avatar"><img src="photo_2024-03-17_19-40-25.jpg" alt="Avatar"></div>
                <div class="user-text">
                    <span class="user-name">My Budget</span>
                    <span class="user-greeting">Welcome back</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="header-btn add-btn" id="quickAddBtn"><i class="fas fa-plus"></i></button>
                <button class="header-btn expense-icon-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>
        </header>

        <main class="main-content">
            <section id="dashboard" class="content-section active">
                <div class="budget-card">
                    <span class="budget-label" data-i18n="myBudget">My Budget</span>
                    <span class="budget-amount" id="budgetBalance">0.00</span>
                    <div class="overview-cards">
                        <div class="overview-card income-card">
                            <span class="overview-label" data-i18n="income">Income</span>
                            <span class="overview-amount" id="totalIncome">0.00</span>
                        </div>
                        <div class="overview-card expense-card">
                            <span class="overview-label" data-i18n="spending">Spending</span>
                            <span class="overview-amount" id="totalExpenses">0.00</span>
                        </div>
                    </div>
                </div>

                <div class="transactions-section">
                    <div class="transactions-header">
                        <h2 class="transactions-title" data-i18n="transaction">Transaction</h2>
                        <div class="see-all-btn" id="seeAllBtn">
                            <span data-i18n="seeAll">See all</span>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                    <div class="transactions-list" id="transactionsList"></div>
                </div>

                <h3 class="chart-section-title" data-i18n="incomeVsSpending">Income VS Spending</h3>
                <div class="chart-section">
                    <canvas id="incomeVsSpendingChart"></canvas>
                </div>
            </section>

            <section id="transactions" class="content-section">
                <div class="section-header">
                    <div class="month-selector" id="transactionMonthSelector"><span id="transactionCurrentMonth">December</span><i class="fas fa-chevron-down"></i></div>
                    <button class="header-btn search-btn" id="transactionSearchToggle" style="width: 30px; height: 30px; font-size: 0.77rem; margin-left: 12px; background: #252525; color: white;"><i class="fas fa-search"></i></button>
                </div>
                <div id="transactionSearchBox" style="display: none; margin-bottom: 16px;">
                    <input type="text" id="transactionSearchInput" data-i18n-placeholder="searchTransactions" placeholder="Search transactions..." style="width: 100%; padding: 12px 16px; background: var(--card); border: 1px solid #3A3A3A; border-radius: 12px; color: var(--text); font-size: 0.9rem;">
                </div>
                <div class="overview-cards" style="margin-bottom: 24px;">
                    <div class="overview-card income-card filter-card" id="filterIncomeBtn">
                        <span class="overview-label" data-i18n="income">Income</span>
                        <span class="overview-amount" id="transactionTotalIncome">0.00</span>
                    </div>
                    <div class="overview-card expense-card filter-card" id="filterExpenseBtn">
                        <span class="overview-label" data-i18n="spending">Spending</span>
                        <span class="overview-amount" id="transactionTotalExpenses">0.00</span>
                    </div>
                </div>
                <input type="hidden" id="transactionDateFrom">
                <input type="hidden" id="transactionDateTo">
                <div class="transactions-full-list" id="transactionsFullList"></div>
            </section>

            <section id="reports" class="content-section">
                <div class="section-header">
                    <div class="report-controls">
                        <button class="period-btn" data-months="0.25" data-i18n="week">Week</button>
                        <button class="period-btn" data-months="1" data-i18n="month">Month</button>
                        <button class="period-btn" data-months="3" data-i18n="threeMonths">3 Months</button>
                        <button class="period-btn active" data-months="6" data-i18n="sixMonths">6 Months</button>
                        <button class="period-btn" data-months="12" data-i18n="year">Year</button>
                    </div>
                </div>
                <div class="reports-grid">
                    <div class="report-section">
                        <h3 class="report-title" data-i18n="monthlyTrends">Monthly Trends</h3>
                        <div class="report-card">
                            <canvas id="monthlyTrendsChart"></canvas>
                        </div>
                    </div>
                    <div class="report-section">
                        <h3 class="report-title" data-i18n="expensesByCategory">Expenses by Category</h3>
                        <div class="report-card">
                            <canvas id="categoryAnalysisChart"></canvas>
                        </div>
                        <div id="expenseCategoryCards" class="category-cards"></div>
                    </div>
                    <div class="report-section">
                        <h3 class="report-title" data-i18n="incomeByCategory">Income by Category</h3>
                        <div class="report-card">
                            <canvas id="incomeCategoryChart"></canvas>
                        </div>
                        <div id="incomeCategoryCards" class="category-cards"></div>
                    </div>
                    <div class="report-section">
                        <h3 class="report-title" data-i18n="topExpenses">Top Expenses</h3>
                        <div id="topExpensesList" class="top-list"></div>
                    </div>
                    <div class="report-section">
                        <h3 class="report-title" data-i18n="topIncomeSources">Top Income Sources</h3>
                        <div id="topIncomeList" class="top-list"></div>
                    </div>
                </div>
            </section>

            <section id="settings" class="content-section">
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3 data-i18n="language">Language</h3>
                        <div class="language-selector">
                            <button class="language-btn" data-lang="en">EN</button>
                            <button class="language-btn" data-lang="ru">RU</button>
                        </div>
                    </div>
                    <div class="settings-card">
                        <h3 data-i18n="currency">Currency</h3>
                        <div class="currency-selector">
                            <button class="currency-btn" data-currency="$">$</button>
                            <button class="currency-btn" data-currency="₽">₽</button>
                        </div>
                    </div>
                    <div class="settings-card"><h3 data-i18n="expenseCategories">Expense Categories</h3><div id="expenseCategoriesList" class="category-list"></div><button class="btn btn-secondary" id="addExpenseCategoryBtn" data-i18n="add">Add</button></div>
                    <div class="settings-card"><h3 data-i18n="incomeCategories">Income Categories</h3><div id="incomeCategoriesList" class="category-list"></div><button class="btn btn-secondary" id="addIncomeCategoryBtn" data-i18n="add">Add</button></div>
                </div>
            </section>

            <section id="addCategory" class="content-section">
                <h3 class="section-subtitle" id="addCategoryTitle" data-i18n="addNewCategory">Add New Category</h3>
                
                <div class="add-category-section">
                    <form id="categoryForm" class="category-form">
                        <div class="form-group">
                            <label data-i18n="categoryName">Category Name</label>
                            <input type="text" id="categoryName" data-i18n-placeholder="enterCategoryName" placeholder="Enter category name..." required>
                        </div>
                        <div class="form-group">
                            <label data-i18n="selectIcon">Select Icon</label>
                            <div class="icon-search-box">
                                <input type="text" id="iconSearch" data-i18n-placeholder="searchIcons" placeholder="Search icons...">
                            </div>
                            <div class="icon-grid" id="iconGrid"></div>
                            <input type="hidden" id="selectedIcon" value="wallet">
                            <input type="hidden" id="categoryType" value="expense">
                        </div>
                    </form>
                </div>
                
                <button type="submit" form="categoryForm" class="btn btn-primary btn-add-category-floating">
                    <i class="fas fa-plus"></i>
                    <span data-i18n="addCategory">Add Category</span>
                </button>
            </section>
        </main>

        <nav class="bottom-nav">
            <button class="bottom-nav-btn active" data-section="dashboard"><i class="fas fa-home"></i><span data-i18n="home">Home</span></button>
            <button class="bottom-nav-btn" data-section="income"><i class="fas fa-plus-circle"></i><span data-i18n="incomeNav">Income</span></button>
            <button class="bottom-nav-btn" data-section="expenses"><i class="fas fa-minus-circle"></i><span data-i18n="expenses">Expenses</span></button>
            <button class="bottom-nav-btn" data-section="reports"><i class="fas fa-chart-bar"></i><span data-i18n="reports">Reports</span></button>
            <button class="bottom-nav-btn" data-section="settings"><i class="fas fa-cog"></i><span data-i18n="settings">Settings</span></button>
        </nav>
    </div>

    <!-- Expense Modal -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="addExpense">Add Expense</h3>
                <span class="close">&times;</span>
            </div>
            <form id="expenseForm">
                <div class="form-group">
                    <label data-i18n="date">Date</label>
                    <div class="date-picker-field" id="expenseDatePicker">
                        <span id="expenseDateDisplay" data-i18n="selectDate">Select date</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <input type="hidden" id="expenseDate" required>
                </div>
                <div class="date-presets">
                    <button type="button" class="preset-btn" data-days="0" data-type="expense" data-i18n="today">Today</button>
                    <button type="button" class="preset-btn" data-days="-1" data-type="expense" data-i18n="yesterday">Yesterday</button>
                    <button type="button" class="preset-btn" data-days="-7" data-type="expense" data-i18n="weekAgo">Week ago</button>
                </div>
                <div class="form-group">
                    <label data-i18n="category">Category</label>
                    <div class="category-grid" id="expenseCategoryGrid"></div>
                    <input type="hidden" id="expenseCategory" required>
                </div>
                <div class="form-group">
                    <label data-i18n="amount">Amount</label>
                    <input type="number" id="expenseAmount" step="0.01" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelExpenseBtn" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="add">Add</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Income Modal -->
    <div id="incomeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="addIncome">Add Income</h3>
                <span class="close">&times;</span>
            </div>
            <form id="incomeForm">
                <div class="form-group">
                    <label data-i18n="date">Date</label>
                    <div class="date-picker-field" id="incomeDatePicker">
                        <span id="incomeDateDisplay" data-i18n="selectDate">Select date</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <input type="hidden" id="incomeDate" required>
                </div>
                <div class="date-presets">
                    <button type="button" class="preset-btn" data-days="0" data-type="income" data-i18n="today">Today</button>
                    <button type="button" class="preset-btn" data-days="-1" data-type="income" data-i18n="yesterday">Yesterday</button>
                    <button type="button" class="preset-btn" data-days="-7" data-type="income" data-i18n="weekAgo">Week ago</button>
                </div>
                <div class="form-group">
                    <label data-i18n="category">Category</label>
                    <div class="category-grid" id="incomeCategoryGrid"></div>
                    <input type="hidden" id="incomeCategory" required>
                </div>
                <div class="form-group">
                    <label data-i18n="amount">Amount</label>
                    <input type="number" id="incomeAmount" step="0.01" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelIncomeBtn" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="add">Add</button>
                </div>
            </form>
        </div>
    </div>

    <div id="quickAddModal" class="modal"><div class="modal-content quick-add-content"><div class="modal-header"><h3 data-i18n="quickAdd">Quick Add</h3><span class="close">&times;</span></div><div class="quick-add-options"><button class="quick-option income-option" id="quickIncomeBtn"><i class="fas fa-arrow-down"></i><span data-i18n="incomeNav">Income</span></button><button class="quick-option expense-option" id="quickExpenseBtn"><i class="fas fa-arrow-up"></i><span data-i18n="expense">Expense</span></button></div></div></div>

    <div id="singleDateModal" class="date-range-modal">
        <div class="date-range-header">
            <button class="date-range-cancel" id="singleDateCancel">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
            <span class="date-range-title" data-i18n="selectDate">Select date</span>
            <button class="date-range-close" id="singleDateClose" data-i18n="apply">Apply</button>
        </div>
        <div class="date-range-dates">
            <div class="date-range-col">
                <span class="date-range-label" data-i18n="date">Selected date</span>
                <span class="date-range-value" id="singleDateDisplay" data-i18n="selectDate">Select date</span>
            </div>
        </div>
        <div class="date-range-calendars" id="singleDateCalendar"></div>
    </div>

    <div id="dateRangeModal" class="date-range-modal">
        <div class="date-range-header">
            <button class="date-range-clear" id="dateRangeClear" data-i18n="clear">Clear</button>
            <span class="date-range-title" data-i18n="selectPeriod">Select period</span>
            <button class="date-range-close" id="dateRangeClose" data-i18n="apply">Apply</button>
        </div>
        <div class="date-range-presets">
            <button class="preset-btn" data-months="1" data-i18n="month">Month</button>
            <button class="preset-btn" data-months="3" data-i18n="threeMonths">3 Months</button>
            <button class="preset-btn" data-months="6" data-i18n="sixMonths">6 Months</button>
            <button class="preset-btn" data-months="12" data-i18n="year">Year</button>
        </div>
        <div class="date-range-dates">
            <div class="date-range-col">
                <span class="date-range-label" data-i18n="startDate">Start date</span>
                <span class="date-range-value" id="startDateDisplay">1 December</span>
            </div>
            <div class="date-range-col">
                <span class="date-range-label" data-i18n="endDate">End date</span>
                <span class="date-range-value" id="endDateDisplay">4 December</span>
            </div>
        </div>
        <div class="date-range-calendars" id="dateRangeCalendars"></div>
    </div>

    <script src="supabase-client.js"></script>
    <script src="script.js"></script>
    <script src="supabase-adapter.js"></script>
</body>
</html>
